(function(){'use strict';const $loader=$('#loader');const $tbody=$('#coin-table-body');const $feedback=$('#feedback');const rowTpl=document.getElementById('tpl-coin-row').innerHTML;$(init);function init(){loadCoins()}function loadCoins(limit=100){showLoader(true);$.getJSON('./api/coins.php',{action:'list',limit}).done(res=>{if(!res||!res.data){return showError('Invalid response format')}const rowsHtml=res.data.map(mapCoinToView).map(ctx=>Mustache.render(rowTpl,ctx)).join('');$tbody.html(rowsHtml)}).fail(()=>showError('Failed to load. Please try again later.')).always(()=>showLoader(false))}function mapCoinToView(c){const symbolLower=(c.symbol||'').toLowerCase();return{id:c.id,symbol:c.symbol,name:c.name,pricePretty:money(c.priceUsd),marketCapPretty:compactNumber(c.marketCapUsd),volume24hPretty:compactNumber(c.volumeUsd24Hr),iconUrl:`https://assets.coincap.io/assets/icons/${symbolLower}@2x.png`}}function money(x){const n=Number(x);if(!isFinite(n))return'-';if(n>1)return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});if(n>0.01)return'$'+n.toLocaleString(undefined,{maximumFractionDigits:4});return'$'+n.toExponential(2)}function compactNumber(x){const n=Number(x);if(!isFinite(n))return'-';if(n>=1e12)return'$'+(n/1e12).toFixed(2)+'T';if(n>=1e9)return'$'+(n/1e9).toFixed(2)+'B';if(n>=1e6)return'$'+(n/1e6).toFixed(2)+'M';if(n>=1e3)return'$'+(n/1e3).toFixed(2)+'K';return'$'+n.toFixed(2)}function showLoader(show){$loader.toggle(!!show)}function showError(msg){$feedback.html(`<div class='alert alert-danger' role='alert'>${escapeHtml(msg)}</div>`)}function escapeHtml(s){return String(s).replace(/[&<>\"'`=\/]/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[c]})}})();